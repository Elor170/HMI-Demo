FROM node:20-slim
ARG ServiceName

WORKDIR /app/libs/hmi-helper
COPY libs/hmi-helper .

WORKDIR /app
RUN corepack enable
RUN corepack use pnpm
COPY pnpm-*.yaml .
COPY tsconfig.*.json .

WORKDIR /app/packages/service
COPY packages/$ServiceName/package*.json .
RUN pnpm i
COPY packages/$ServiceName ./
RUN pnpm build

CMD ["pnpm", "start"]