FROM barichello/godot-ci:latest as build

WORKDIR /app/game

COPY . .

RUN godot --export-release --headless "Web" dist/index.html
RUN rm -f server.py

WORKDIR /app
FROM python:3.9 as final

COPY --from=build /app/game/dist /app/game

WORKDIR /app/game
COPY server.py .

EXPOSE 8000

CMD [ "python", "server.py" ]
